<?php

namespace App\Presenters;

use App\Model\DI\GoogleAnalytics;
use App\Model\DI\Seo;
use App\Model\Utils;
use Contributte;
use Nette;
use Nette\Application\Helpers;

/**
 * Class BasePresenter
 * @package App\Presenters
 */
abstract class BasePresenter extends Nette\Application\UI\Presenter
{
    private GoogleAnalytics $googleAnalytics;
    private Seo $seo;

    /** @var Nette\Localization\Translator @inject */
    public Nette\Localization\Translator $translator;

    /** @var Contributte\Translation\LocalesResolvers\Session @inject */
    public Contributte\Translation\LocalesResolvers\Session $translatorSessionResolver;

    /**
     * BasePresenter constructor.
     * @param GoogleAnalytics $googleAnalytics
     * @param Seo $seo
     */
    public function __construct(GoogleAnalytics $googleAnalytics, Seo $seo)
    {
        parent::__construct();

        $this->googleAnalytics = $googleAnalytics;
        $this->seo = $seo;
    }

    /**
     * @return array
     */
    public function formatTemplateFiles(): array
    {
        [$module, $presenter] = Helpers::splitName($this->getName());
        $dir = dirname(static::getReflection()->getFileName());
        $dir = is_dir("$dir/templates") ? $dir : dirname($dir);
        return [
            "$dir/templates/$module/$presenter/$this->view.latte",
            "$dir/templates/$module/$presenter.$this->view.latte",
        ];
    }

    public function startup()
    {
        parent::startup(); // TODO: Change the autogenerated stub

        $this->template->addFilter('substrWithoutHTML', fn($value, $limit) => trim(Utils::substrWithoutHTML($value, $limit)));
        $this->template->sklonovani = fn($pocet, $slova) => Utils::sklonovani($pocet, $slova);
        $this->template->httpRequest = $this->getHttpRequest();
        $this->template->googleAnalytics = $this->googleAnalytics;
        $this->template->seo = $this->seo;
    }

    /**
     * @return Nette\Localization\Translator
     */
    public function getTranslator(): Nette\Localization\Translator
    {
        return $this->translator;
    }

    /**
     * @return Contributte\Translation\LocalesResolvers\Session
     */
    public function getTranslatorSessionResolver(): Contributte\Translation\LocalesResolvers\Session
    {
        return $this->translatorSessionResolver;
    }
}